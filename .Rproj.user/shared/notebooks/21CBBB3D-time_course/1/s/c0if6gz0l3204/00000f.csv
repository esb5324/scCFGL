"0","count=TC"
"0","count = count[, colSums(count) > 0]"
"0","genes = colnames(count)"
"0","genes = strsplit(genes, split = ""-"")"
"0","genes = sapply(genes, function(x) x[1])"
"0","count = count[, genes != ""ERCC""]"
"0","cs = rowSums(count)"
"0","scale.factor = 1e6"
"0","rcnt = sweep(count, 1, scale.factor/cs, FUN = ""*"")"
"0",""
"0","### filter by genes -------------------------------------------"
"0","filter_genes_median = function(x, topn = 1500, frac_thre = 0.1){"
"0","  frac = colMeans(x > 0)"
"0","  x[x == 0] = NA"
"0","  mu = apply(x, 2, median, na.rm = TRUE)"
"0","  genes = colnames(x)"
"0","  mu = mu[frac > frac_thre]"
"0","  genes = genes[frac > frac_thre]"
"0","  ord = order(mu, decreasing = TRUE)[1:topn]"
"0","  return(genes[ord])"
"0","}"
"0","keep.genes = filter_genes_median(rcnt, topn = 1000, frac_thre = 0.1)"
"0","rcnt = rcnt[, keep.genes]"
"0","rcnt = log10(rcnt + 1)"
